#include "terminal.h"

uint16_t get_crc(const uint8_t data[], uint16_t size)
{
  uint16_t i, tmp, crc = 0xffff;

  for (i = 0; i < size; i++)
  {
    tmp = (crc >> 8) ^ (0x00ff & data[i]);
    crc = (crc << 8) ^ crc16_ccitt_table[tmp];
  }
  return crc;
}

uint32_t power(uint16_t x, uint8_t n)
{
  if (n == 0)
    return 1;
  if (n < 0)
    return power(1.0 / x, -n);
  return x * power(x, n - 1);
}

void gen_head_mes(vtc_request *r)
{
  r->data[0] = VTK_START_BYTE;
  r->data[1] = 0;
  r->data[2] = 0;
  r->data[3] = VTK_BASE_VMC_L;
  r->data[4] = VTK_BASE_VMC_R;
  r->len = 2;
}

void add_param(vtc_request *r, char mes[BUFFER_SIZE1], uint16_t len)
{
  uint16_t iter = 0;
  if ((mes[0] <= 21) && (mes[0] > 0) && (mes[0] != 2))
  {
    r->data[3 + r->len] = mes[0];
    r->len++;
    iter++;
    if (len > 256)
    {
      r->data[3 + r->len] = 0x82;
      r->len++;
      r->data[3 + r->len] = ((len - 1) >> 8);
      r->len++;
      r->data[3 + r->len] = (len - 1);
      r->len++;
    }
    else
    {
      r->data[3 + r->len] = len - 1;
      r->len++;
    }
    while (iter != len)
    {
      r->data[3 + r->len] = mes[iter];
      r->len++;
      iter++;
    }
  }
}

void gen_end_mes(vtc_request *r)
{
  uint16_t crc = 0;
  r->data[1] = (r->len) >> 8;
  r->data[2] = (r->len) & 0xFF;
  r->len = r->len + 3;
  crc = get_crc(r->data, r->len);
  r->data[r->len] = crc >> 8;
  r->len++;
  r->data[r->len] = crc & 0xFF;
  r->len++;
}

uint8_t chek_param(uint8_t mes[], uint16_t len, char chek_mes[BUFFER_SIZE1], uint16_t lenchek)
{
  lenchek--;
  uint8_t ret = 1;
  uint16_t i = 5;
  uint16_t lch = 1;
  while (i <= len)
  {
    if (mes[i] == chek_mes[0])
    {
      i++;
      uint8_t j = mes[i] + i;
      if (mes[i] != lenchek)
        ret = 0;
      i++;
      while (i <= j)
      {
        if (mes[i] != chek_mes[lch])
          ret = 0;
        if (lch < lenchek)
          lch++;
        i++;
      }
    }
    else
    {
      i = mes[i + 1] + i + 2;
    }
  }
  return ret;
}

uint32_t get_num_value_param(vtc_request *r, char chek_mes)
{
  uint32_t ret = 0;
  uint16_t i = 5;
  while (i <= r->len)
  {
    if (r->data[i] == chek_mes)
    {
      i++;
      uint16_t j = r->data[i] + i;
      i++;
      while (i <= j)
      {
        ret = ret + (r->data[i] - 0x30) * power(10, j - i);
        i++;
      }
    }
    else
    {
      i = r->data[i + 1] + i + 2;
    }
  }
  return ret;
}

void gen_IDL(vtc_request *r)
{
  gen_head_mes(r);
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%d", VTK_OPERATION_NUMBER, oper_num));
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%s", VTK_MESSAGE_NAME, VTK_IDL));
  gen_end_mes(r);
}

void gen_IDL_QR(vtc_request *r, char *qr)
{
  gen_head_mes(r);
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%s", VTK_MESSAGE_NAME, VTK_IDL));
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%d", VTK_OPERATION_NUMBER, oper_num));
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%s", VTK_QR_CODE_DATA, qr));
  gen_end_mes(r);
}

void gen_test_VTK_BANKING_RECEIPT(vtc_request *r, char *qr)
{
  gen_head_mes(r);
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%s", VTK_MESSAGE_NAME, VTK_IDL));
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%d", VTK_OPERATION_NUMBER, oper_num));
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%s", VTK_BANKING_RECEIPT, qr));
  gen_end_mes(r);
}

void gen_DIS(vtc_request *r)
{
  gen_head_mes(r);
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%s", VTK_MESSAGE_NAME, VTK_DIS));
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%d", VTK_OPERATION_NUMBER, oper_num));
  gen_end_mes(r);
}

void gen_VRP(vtc_request *r, uint16_t ammount, uint16_t prod_ID, char *name)
{
  oper_num++;
  gen_head_mes(r);
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%s", VTK_MESSAGE_NAME, VTK_VRP));
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%d", VTK_OPERATION_NUMBER, oper_num));
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%d", VTK_AMOUNT, ammount));
#ifdef ENABEL_PRICE_NAME_ITEM
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%d", VTK_PRODUCT_ID, prod_ID));
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%s", VTK_PRODUCT_NAME, name));
#endif
  gen_end_mes(r);
}

// int x=BILDDAUER_LEER_VOLL;
void gen_IDL_SCREEN_EMPTY(vtc_request *r)
{
  // BILDDAUER_LEER_VOLL
  gen_head_mes(r);
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%s", VTK_MESSAGE_NAME, VTK_IDL));
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%d", VTK_OPERATION_NUMBER, oper_num));
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%d", VTK_DISPLAY_TIME_MS, 3000));
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%s", VTK_IMAGE_NAME, VTK_EMPTY));
  gen_end_mes(r);
}

void gen_IDL_SCREEN_TAKE(vtc_request *r)
{
  // BILDDAUER_LEER_VOLL
  gen_head_mes(r);
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%s", VTK_MESSAGE_NAME, VTK_IDL));
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%d", VTK_OPERATION_NUMBER, oper_num));
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%d", VTK_DISPLAY_TIME_MS, 7000));
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%s", VTK_IMAGE_NAME, VTK_TAKE));
  gen_end_mes(r);
}

void gen_IDL_SCREEN_OWNER(vtc_request *r)
{
  gen_head_mes(r);
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%s", VTK_MESSAGE_NAME, VTK_IDL));
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%d", VTK_OPERATION_NUMBER, oper_num));
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%d", VTK_DISPLAY_TIME_MS, BILDDAUER_LEER_VOLL));
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%s", VTK_IMAGE_NAME, VTK_OWNER));
  gen_end_mes(r);
}

void gen_FIN(vtc_request *r, uint16_t ammount, uint16_t prod_ID, char *name)
{
  gen_head_mes(r);
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%s", VTK_MESSAGE_NAME, VTK_FIN));
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%d", VTK_OPERATION_NUMBER, oper_num));
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%d", VTK_AMOUNT, ammount));
#ifdef ENABEL_PRICE_NAME_ITEM
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%d", VTK_PRODUCT_ID, prod_ID));
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%s", VTK_PRODUCT_NAME, name));
#endif
  gen_end_mes(r);
}

void gen_ABR(vtc_request *r)
{
  gen_head_mes(r);
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%s", VTK_MESSAGE_NAME, VTK_ABR));
  add_param(r, buf, snprintf(buf, BUFFER_SIZE1, "%c%d", VTK_OPERATION_NUMBER, oper_num));
  gen_end_mes(r);
}

bool chekSEAL(vtc_request *r)
{
  if (chek_param(r->data, r->len, buf, snprintf(buf, BUFFER_SIZE1, "%c%s", VTK_MESSAGE_NAME, VTK_VRP)))
  {
    if (get_num_value_param(r, VTK_AMOUNT) > 0)
    {
      return 1;
    }
    else
    {
      return 0; //- BAD SALE
    }
  }
}

bool chekCART(vtc_request *r)
{
  bool rt = 0;

  if (chek_param(r->data, r->len, buf, snprintf(buf, BUFFER_SIZE1, "%c%s", VTK_MESSAGE_NAME, VTK_MFR)))
  {
    rt = 1;
  }
  return rt;
}

bool get_brecpt(char *bufer, vtc_request *r)
{
  bool rt = 0;
  memset(bufer, 0, sizeof(bufer)); // заполняет массив buffer 0-ми. на всю длину
  uint16_t i = 5;
  uint16_t j = 0;
  while (i <= r->len)
  {
    if ((r->data[i] == VTK_BANKING_RECEIPT) && (r->data[i + 1] != 0x81))
    {
      rt = 1;
      i++;
      i++;
      j = ((unsigned char)r->data[i] << 8) | ((unsigned char)r->data[i + 1]);
      i++;
      //  j = j+i;
      i++;
      uint16_t k = 0;
      while (j)
      {
        bufer[k] = r->data[i];
        i++;
        k++;
        j--;
      }
    }
    i++;
    i += r->data[i];
    i++;
  }
  return rt;
}

void clearR(vtc_request *r)
{
  memset(r->data, 0, BUFFER_SIZE);
  r->len = 0;
}

bool chekFromUart(vtc_request *r)
{
  bool tr = 0;
  if (r->data[0] > 0)
  {
    r->len = (r->data[1] << 8) | (r->data[2]);
    r->len = r->len + 2;
    if (r->data[0] == 0x1f)
    {
      uint16_t crc = (r->data[r->len + 1] << 8) | (r->data[r->len + 2]);
      if (crc == get_crc(r->data, r->len + 1))
      {
        r->len + 2;
        oper_num = get_num_value_param(r, VTK_OPERATION_NUMBER);
        tr = 1;
      }
    }
  }
  else
  {
    clearR(r);
  }
  return tr;
}

// 1f 00 07 96 fb 01 03 49 44 4c 71 4e
// 1f 00 0a 96 fb 01 03 49 44 4c 03 01 30 b6 49

void sendUART(vtc_request *r, int fd)
{
  delay(50);
  for (int i = 0; i < r->len; i++)
  {
    serialPutchar(fd, r->data[i]);
    printf("%x ", r->data[i]);
  }

  printf("\n\n");
  clearR(r);
  delay(50);
}

int readUART(vtc_request *r, int fd)
{
  bool tr = 0;
  uint16_t crc = 0, i = 0;
  delay(100);
  clearR(r);
  while (serialDataAvail(fd))
  {
    r->data[i] = serialGetchar(fd);
    printf("%x ", r->data[i]);
    i++;
    fflush(stdout);
  }
  r->len = i;
  if (i)
    printf("\n");

  if (r->data[0] == 0x1f)
  {
    crc = (r->data[r->len - 2] << 8) | (r->data[r->len - 1]);
    if (crc == get_crc(r->data, r->len - 2))
    {
      oper_num = get_num_value_param(r, VTK_OPERATION_NUMBER);
      tr = 1;
    }
  }

  else
  {
    clearR(r);
  }
  // if (j>0) {j--;readUART(r, fd);}
  delay(100);
  return tr;
}

int read_from_UART(vtc_request *r, int fd)
{
  int tr = 0;
  uint16_t crc = 0, i = 0, j = 0;
  delay(100);
  clearR(r);

  while (serialDataAvail(fd))
  {
    r->data[i] = serialGetchar(fd);
    printf("%x ", r->data[i]);
    i++;
    fflush(stdout);
  }
  r->len = i;
  if (i)
    printf("\n");

  if (r->data[0] == 0x1f)
  {
    crc = (r->data[r->len - 2] << 8) | (r->data[r->len - 1]);
    if (crc == get_crc(r->data, r->len - 2))
    {
      oper_num = get_num_value_param(r, VTK_OPERATION_NUMBER);
      tr = 1;
    }
  }

  else
  {
    clearR(r);
  }

  delay(100);
  return tr;
}

// static  char  testqr[] ={0xd0, 0x9f, 0xd0, 0xbe, 0xd0, 0xb3, 0xd0, 0xb8, 0xd0, 0xb1, 0x20, 0xd0, 0xbf, 0xd0, 0xbe, 0xd1, 0x8d, 0xd1, 0x82, 0x21, 0x20, 0xe2, 0x80, 0x94, 0x20, 0xd0, 0xbd, 0xd0, 0xb5, 0xd0, 0xb2, 0xd0, 0xbe, 0xd0, 0xbb, 0xd1, 0x8c, 0xd0, 0xbd, 0xd0, 0xb8, 0xd0, 0xba, 0x20, 0xd1, 0x87, 0xd0, 0xb5, 0xd1, 0x81, 0xd1, 0x82, 0xd0, 0xb8, 0x20, 0xe2, 0x80, 0x94, 0x0a, 0xd0, 0x9f, 0xd0, 0xb0, 0xd0, 0xbb, 0x2c, 0x20, 0xd0, 0xbe, 0xd0, 0xba, 0xd0, 0xbb, 0xd0, 0xb5, 0xd0, 0xb2, 0xd0, 0xb5, 0xd1, 0x82, 0xd0, 0xb0, 0xd0, 0xbd, 0xd0, 0xbd, 0xd1, 0x8b, 0xd0, 0xb9, 0x20, 0xd0, 0xbc, 0xd0, 0xbe, 0xd0, 0xbb, 0xd0, 0xb2, 0xd0, 0xbe, 0xd0, 0xb9, 0x2c, 0x0a, 0xd0, 0xa1, 0x20, 0xd1, 0x81, 0xd0, 0xb2, 0xd0, 0xb8, 0xd0, 0xbd, 0xd1, 0x86, 0xd0, 0xbe, 0xd0, 0xbc, 0x20, 0xd0, 0xb2, 0x20, 0xd0, 0xb3, 0xd1, 0x80, 0xd1, 0x83, 0xd0, 0xb4, 0xd0, 0xb8, 0x20, 0xd0, 0xb8, 0x20, 0xd0, 0xb6, 0xd0, 0xb0, 0xd0, 0xb6, 0xd0, 0xb4, 0xd0, 0xbe, 0xd0, 0xb9, 0x20, 0xd0, 0xbc, 0xd0, 0xb5, 0xd1, 0x81, 0xd1, 0x82, 0xd0, 0xb8, 0x2c, 0x0a, 0xd0, 0x9f, 0xd0, 0xbe, 0xd0, 0xbd, 0xd0, 0xb8, 0xd0, 0xba, 0xd0, 0xbd, 0xd1, 0x83, 0xd0, 0xb2, 0x20, 0xd0, 0xb3, 0xd0, 0xbe, 0xd1, 0x80, 0xd0, 0xb4, 0xd0, 0xbe, 0xd0, 0xb9, 0x20, 0xd0, 0xb3, 0xd0, 0xbe, 0xd0, 0xbb, 0xd0, 0xbe, 0xd0, 0xb2, 0xd0, 0xbe, 0xd0, 0xb9, 0x21, 0x2e, 0x2e, 0x0a, 0xd0, 0x9d, 0xd0, 0xb5, 0x20, 0xd0, 0xb2, 0xd1, 0x8b, 0xd0, 0xbd, 0xd0, 0xb5, 0xd1, 0x81, 0xd0, 0xbb, 0xd0, 0xb0, 0x20, 0xd0, 0xb4, 0xd1, 0x83, 0xd1, 0x88, 0xd0, 0xb0, 0x20, 0xd0, 0xbf, 0xd0, 0xbe, 0xd1, 0x8d, 0xd1, 0x82, 0xd0, 0xb0, 0x0a, 0xd0, 0x9f, 0xd0, 0xbe, 0xd0, 0xb7, 0xd0, 0xbe, 0xd1, 0x80, 0xd0, 0xb0, 0x20, 0xd0, 0xbc, 0xd0, 0xb5, 0xd0, 0xbb, 0xd0, 0xbe, 0xd1, 0x87, 0xd0, 0xbd, 0xd1, 0x8b, 0xd1, 0x85, 0x20, 0xd0, 0xbe, 0xd0, 0xb1, 0xd0, 0xb8, 0xd0, 0xb4, 0x2c, 0x0a, 0xd0, 0x92, 0xd0, 0xbe, 0xd1, 0x81, 0xd1, 0x81, 0xd1, 0x82, 0xd0, 0xb0, 0xd0, 0xbb, 0x20, 0xd0, 0xbe, 0xd0, 0xbd, 0x20, 0xd0, 0xbf, 0xd1, 0x80, 0xd0, 0xbe, 0xd1, 0x82, 0xd0, 0xb8, 0xd0, 0xb2, 0x20, 0xd0, 0xbc, 0xd0, 0xbd, 0xd0, 0xb5, 0xd0, 0xbd, 0xd0, 0xb8, 0xd0, 0xb9, 0x20, 0xd1, 0x81, 0xd0, 0xb2, 0xd0, 0xb5, 0xd1, 0x82, 0xd0, 0xb0, 0x0a, 0xd0, 0x9e, 0xd0, 0xb4, 0xd0, 0xb8, 0xd0, 0xbd, 0x2c, 0x20, 0xd0, 0xba, 0xd0, 0xb0, 0xd0, 0xba, 0x20, 0xd0, 0xbf, 0xd1, 0x80, 0xd0, 0xb5, 0xd0, 0xb6, 0xd0, 0xb4, 0xd0, 0xb5, 0xe2, 0x80, 0xa6, 0x20, 0xd0, 0xb8, 0x20, 0xd1, 0x83, 0xd0, 0xb1, 0xd0, 0xb8, 0xd1, 0x82, 0x21, 0x0a, 0xd0, 0xa3, 0xd0, 0xb1, 0xd0, 0xb8, 0xd1, 0x82, 0x21, 0x2e, 0x2e, 0x20, 0xd0, 0x9a, 0x20, 0xd1, 0x87, 0xd0, 0xb5, 0xd0, 0xbc, 0xd1, 0x83, 0x20, 0xd1, 0x82, 0xd0, 0xb5, 0xd0, 0xbf, 0xd0, 0xb5, 0xd1, 0x80, 0xd1, 0x8c, 0x20, 0xd1, 0x80, 0xd1, 0x8b, 0xd0, 0xb4, 0xd0, 0xb0, 0xd0, 0xbd, 0xd1, 0x8c, 0xd1, 0x8f, 0x2c, 0x0a, 0xd0, 0x9f, 0xd1, 0x83, 0xd1, 0x81, 0xd1, 0x82, 0xd1, 0x8b, 0xd1, 0x85, 0x20, 0xd0, 0xbf, 0xd0, 0xbe, 0xd1, 0x85, 0xd0, 0xb2, 0xd0, 0xb0, 0xd0, 0xbb, 0x20, 0xd0, 0xbd, 0xd0, 0xb5, 0xd0, 0xbd, 0xd1, 0x83, 0xd0, 0xb6, 0xd0, 0xbd, 0xd1, 0x8b, 0xd0, 0xb9, 0x20, 0xd1, 0x85, 0xd0, 0xbe, 0xd1, 0x80, 0x0a, 0xd0, 0x98, 0x20, 0xd0, 0xb6, 0xd0, 0xb0, 0xd0, 0xbb, 0xd0, 0xba, 0xd0, 0xb8, 0xd0, 0xb9, 0x20, 0xd0, 0xbb, 0xd0, 0xb5, 0xd0, 0xbf, 0xd0, 0xb5, 0xd1, 0x82, 0x20, 0xd0, 0xbe, 0xd0, 0xbf, 0xd1, 0x80, 0xd0, 0xb0, 0xd0, 0xb2, 0xd0, 0xb4, 0xd0, 0xb0, 0xd0, 0xbd, 0xd1, 0x8c, 0xd1, 0x8f, 0x3f};
// static char  testqr[]= {0x01, 0x8f, 0xd0, 0x9e, 0xd0, 0x9f, 0xd0, 0x95, 0xd0, 0xa0, 0xd0, 0x90, 0xd0, 0xa6, 0xd0, 0x98, 0xd0,0xaf, 0x3a, 0xd0, 0x9f, 0xd0, 0xa0, 0xd0, 0x9e, 0xd0, 0x94, 0xd0, 0x90, 0xd0, 0x96, 0xd0, 0x90, 0xa, 0xd0, 0x98, 0xd0, 0xa2, 0xd0, 0x9e, 0xd0, 0x93, 0xd0, 0x9e, 0x3a, 0x33, 0x2e, 0x31, 0x30, 0x20, 0x52, 0x55, 0x42, 0x0a ,0xd0, 0xa0, 0xd0, 0x95, 0xd0, 0x97, 0xd0, 0xa3, 0xd0, 0x9b, 0xd0, 0xac, 0xd0, 0xa2, 0xd0, 0x90, 0xd0, 0xa2, 0x3a, 0xd0, 0x9e, 0xd0, 0x94, 0xd0, 0x9e, 0xd0, 0x91, 0xd0, 0xa0, 0xd0, 0x95, 0xd0, 0x9d, 0xd0, 0x9e, 0xa, 0xd0, 0x9a, 0xd0, 0x90, 0xd0, 0xa0, 0xd0, 0xa2, 0xd0, 0x90, 0x3a, 0x4d, 0x49, 0x52, 0xa, 0x50, 0x41, 0x4e, 0x3a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x30, 0x34, 0x35, 0x37, 0xa, 0x4d, 0x4f, 0x44, 0x45, 0x3a, 0x43, 0x4f, 0x4e, 0x54, 0x41, 0x43, 0x54, 0x4c, 0x45, 0x53,0x53, 0x20, 0x45, 0x4d, 0x56, 0xa, 0xd0, 0xa7, 0xd0, 0x95, 0xd0, 0x9a, 0x3a, 0x35, 0x33, 0x39, 0x32, 0x34, 0x31, 0xa, 0xd0, 0x9a, 0xd0, 0x9e, 0xd0, 0x94, 0x20, 0xd0, 0x90, 0xd0, 0x92, 0xd0, 0xa2, 0x3a, 0x38, 0x55, 0x31, 0x39, 0x46, 0x52, 0xa,0xd0, 0x94, 0xd0, 0x90, 0xd0, 0xa2, 0xd0, 0x90, 0x3a, 0x30, 0x35, 0x2f, 0x30, 0x32, 0x2f, 0x32, 0x30, 0x32, 0x34, 0x20, 0x31, 0x34, 0x3a, 0x31, 0x37, 0x3a,0x32, 0x34, 0xa, 0xd0, 0xa2, 0xd0, 0x95, 0xd0, 0xa0, 0xd0, 0x9c, 0xd0, 0x98, 0xd0, 0x9d, 0xd0, 0x90, 0xd0, 0x9b, 0x3a, 0x57, 0x30, 0x31, 0x31, 0x37, 0x35, 0x31, 0x38, 0xa, 0x4d, 0x45, 0x52, 0x43, 0x48, 0x41, 0x4e, 0x54, 0x3a, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x39, 0x39, 0x39, 0x30, 0x30, 0x30, 0x30, 0x31, 0xa, 0x43, 0x56, 0x4d, 0x3a, 0x4e, 0x6f, 0x43, 0x56, 0x4d, 0xa, 0x54, 0x56, 0x52, 0x3a, 0x38, 0x30, 0x38, 0x30, 0x30, 0x30, 0x38, 0x30, 0x30, 0x30, 0xa, 0x41, 0x49, 0x44, 0x3a, 0x41, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x36, 0x35, 0x38, 0x31,0x30, 0x31, 0x30, 0xa, 0x41, 0x50, 0x50, 0x3a, 0x4d, 0x49, 0x52, 0xa, 0x54, 0x43, 0x3a, 0x35, 0x31, 0x37, 0x38, 0x39, 0x34, 0x45, 0x36, 0x36, 0x33, 0x34, 0x42, 0x35, 0x38, 0x41, 0x31, 0xa, 0x52, 0x52, 0x4e, 0x3a, 0x30, 0x30, 0x32, 0x31, 0x31, 0x30, 0x34, 0x39, 0x37, 0x38, 0x34, 0x39, 0xa, 0x41, 0x4d, 0x32, 0x3a, 0x30, 0x2e, 0x30, 0x30, 0xa, 0x42, 0x41, 0x54, 0x43, 0x48, 0x3a, 0x32, 0x31, 0xa, 0x45, 0x52, 0x4e, 0x3a, 0x37, 0x38, 0x34, 0xa, 0xd0, 0x9a, 0xd0, 0x9e, 0xd0, 0x94, 0x20, 0xd0, 0x9e, 0xd0, 0xa2, 0xd0, 0x92, 0xd0, 0x95, 0xd0, 0xa2, 0xd0, 0x90, 0x3a, 0x30, 0x30, 0x30, 0xa};
// static char  testqr[548] ={0xd0, 0x9f, 0xd0, 0xbe, 0xd0, 0xb3, 0xd0, 0xb8, 0xd0, 0xb1, 0x20, 0xd0, 0xbf, 0xd0, 0xbe, 0xd1, 0x8d, 0xd1, 0x82, 0x21, 0x20, 0xe2, 0x80, 0x94, 0x20, 0xd0, 0xbd, 0xd0, 0xb5, 0xd0, 0xb2, 0xd0, 0xbe, 0xd0, 0xbb, 0xd1, 0x8c, 0xd0, 0xbd, 0xd0, 0xb8, 0xd0, 0xba, 0x20, 0xd1, 0x87, 0xd0, 0xb5, 0xd1, 0x81, 0xd1, 0x82, 0xd0, 0xb8, 0x20, 0xe2, 0x80, 0x94, 0x0a, 0xd0, 0x9f, 0xd0, 0xb0, 0xd0, 0xbb, 0x2c, 0x20, 0xd0, 0xbe, 0xd0, 0xba, 0xd0, 0xbb, 0xd0, 0xb5, 0xd0, 0xb2, 0xd0, 0xb5, 0xd1, 0x82, 0xd0, 0xb0, 0xd0, 0xbd, 0xd0, 0xbd, 0xd1, 0x8b, 0xd0, 0xb9, 0x20, 0xd0, 0xbc, 0xd0, 0xbe, 0xd0, 0xbb, 0xd0, 0xb2, 0xd0, 0xbe, 0xd0, 0xb9, 0x2c, 0x0a, 0xd0, 0xa1, 0x20, 0xd1, 0x81, 0xd0, 0xb2, 0xd0, 0xb8, 0xd0, 0xbd, 0xd1, 0x86, 0xd0, 0xbe, 0xd0, 0xbc, 0x20, 0xd0, 0xb2, 0x20, 0xd0, 0xb3, 0xd1, 0x80, 0xd1, 0x83, 0xd0, 0xb4, 0xd0, 0xb8, 0x20, 0xd0, 0xb8, 0x20, 0xd0, 0xb6, 0xd0, 0xb0, 0xd0, 0xb6, 0xd0, 0xb4, 0xd0, 0xbe, 0xd0, 0xb9, 0x20, 0xd0, 0xbc, 0xd0, 0xb5, 0xd1, 0x81, 0xd1, 0x82, 0xd0, 0xb8, 0x2c, 0x0a, 0xd0, 0x9f, 0xd0, 0xbe, 0xd0, 0xbd, 0xd0, 0xb8, 0xd0, 0xba, 0xd0, 0xbd, 0xd1, 0x83, 0xd0, 0xb2, 0x20, 0xd0, 0xb3, 0xd0, 0xbe, 0xd1, 0x80, 0xd0, 0xb4, 0xd0, 0xbe, 0xd0, 0xb9, 0x20, 0xd0, 0xb3, 0xd0, 0xbe, 0xd0, 0xbb, 0xd0, 0xbe, 0xd0, 0xb2, 0xd0, 0xbe, 0xd0, 0xb9, 0x21, 0x2e, 0x2e, 0x0a, 0xd0, 0x9d, 0xd0, 0xb5, 0x20, 0xd0, 0xb2, 0xd1, 0x8b, 0xd0, 0xbd, 0xd0, 0xb5, 0xd1, 0x81, 0xd0, 0xbb, 0xd0, 0xb0, 0x20, 0xd0, 0xb4, 0xd1, 0x83, 0xd1, 0x88, 0xd0, 0xb0, 0x20, 0xd0, 0xbf, 0xd0, 0xbe, 0xd1, 0x8d, 0xd1, 0x82, 0xd0, 0xb0, 0x0a, 0xd0, 0x9f, 0xd0, 0xbe, 0xd0, 0xb7, 0xd0, 0xbe, 0xd1, 0x80, 0xd0, 0xb0, 0x20, 0xd0, 0xbc, 0xd0, 0xb5, 0xd0, 0xbb, 0xd0, 0xbe, 0xd1, 0x87, 0xd0, 0xbd, 0xd1, 0x8b, 0xd1, 0x85, 0x20, 0xd0, 0xbe, 0xd0, 0xb1, 0xd0, 0xb8, 0xd0, 0xb4, 0x2c, 0x0a, 0xd0, 0x92, 0xd0, 0xbe, 0xd1, 0x81, 0xd1, 0x81, 0xd1, 0x82, 0xd0, 0xb0, 0xd0, 0xbb, 0x20, 0xd0, 0xbe, 0xd0, 0xbd, 0x20, 0xd0, 0xbf, 0xd1, 0x80, 0xd0, 0xbe, 0xd1, 0x82, 0xd0, 0xb8, 0xd0, 0xb2, 0x20, 0xd0, 0xbc, 0xd0, 0xbd, 0xd0, 0xb5, 0xd0, 0xbd, 0xd0, 0xb8, 0xd0, 0xb9, 0x20, 0xd1, 0x81, 0xd0, 0xb2, 0xd0, 0xb5, 0xd1, 0x82, 0xd0, 0xb0, 0x0a, 0xd0, 0x9e, 0xd0, 0xb4, 0xd0, 0xb8, 0xd0, 0xbd, 0x2c, 0x20, 0xd0, 0xba, 0xd0, 0xb0, 0xd0, 0xba, 0x20, 0xd0, 0xbf, 0xd1, 0x80, 0xd0, 0xb5, 0xd0, 0xb6, 0xd0, 0xb4, 0xd0, 0xb5, 0xe2, 0x80, 0xa6, 0x20, 0xd0, 0xb8, 0x20, 0xd1, 0x83, 0xd0, 0xb1, 0xd0, 0xb8, 0xd1, 0x82, 0x21, 0x0a, 0xd0, 0xa3, 0xd0, 0xb1, 0xd0, 0xb8, 0xd1, 0x82, 0x21, 0x2e, 0x2e, 0x20, 0xd0, 0x9a, 0x20, 0xd1, 0x87, 0xd0, 0xb5, 0xd0, 0xbc, 0xd1, 0x83, 0x20, 0xd1, 0x82, 0xd0, 0xb5, 0xd0, 0xbf, 0xd0, 0xb5, 0xd1, 0x80, 0xd1, 0x8c, 0x20, 0xd1, 0x80, 0xd1, 0x8b, 0xd0, 0xb4, 0xd0, 0xb0, 0xd0, 0xbd, 0xd1, 0x8c, 0xd1, 0x8f, 0x2c, 0x0a, 0xd0, 0x9f, 0xd1, 0x83, 0xd1, 0x81, 0xd1, 0x82, 0xd1, 0x8b, 0xd1, 0x85, 0x20, 0xd0, 0xbf, 0xd0, 0xbe, 0xd1, 0x85, 0xd0, 0xb2, 0xd0, 0xb0, 0xd0, 0xbb, 0x20, 0xd0, 0xbd, 0xd0, 0xb5, 0xd0, 0xbd, 0xd1, 0x83, 0xd0, 0xb6, 0xd0, 0xbd, 0xd1, 0x8b, 0xd0, 0xb9, 0x20, 0xd1, 0x85, 0xd0, 0xbe, 0xd1, 0x80, 0x0a, 0xd0, 0x98, 0x20, 0xd0, 0xb6, 0xd0, 0xb0, 0xd0, 0xbb, 0xd0, 0xba, 0xd0, 0xb8, 0xd0, 0xb9, 0x20, 0xd0, 0xbb, 0xd0, 0xb5, 0xd0, 0xbf, 0xd0, 0xb5, 0xd1, 0x82, 0x20, 0xd0, 0xbe, 0xd0, 0xbf, 0xd1, 0x80, 0xd0, 0xb0, 0xd0, 0xb2, 0xd0, 0xb4, 0xd0, 0xb0, 0xd0, 0xbd, 0xd1, 0x8c, 0xd1, 0x8f, 0x3f};

// static char testqr[]={0xd0,0x9e,0xd0,0x9f,0xd0,0x95,0xd0,0xa0,0xd0,0x90,0xd0,0xa6,0xd0,0x98,0xd0,0xaf,0x3a,0xd0,0x9f,0xd0,0xa0,0xd0,0x9e,0xd0,0x94,0xd0,0x90,0xd0,0x96,0xd0,0x90,0xa,0xd0,0x98,0xd0,0xa2,0xd0,0x9e,0xd0,0x93,0xd0,0x9e,0x3a,0x33,0x2e,0x30,0x30,0x20,0x52,0x55,0x42,0xa,0xd0,0xa0,0xd0,0x95,0xd0,0x97,0xd0,0xa3,0xd0,0x9b,0xd0,0xac,0xd0,0xa2,0xd0,0x90,0xd0,0xa2,0x3a,0xd0,0x9e,0xd0,0x94,0xd0,0x9e,0xd0,0x91,0xd0,0xa0,0xd0,0x95,0xd0,0x9d,0xd0,0x9e,0xa,0xd0,0x9a,0xd0,0x90,0xd0,0xa0,0xd0,0xa2,0xd0,0x90,0x3a,0x4d,0x49,0x52,0xa,0x50,0x41,0x4e,0x3a,0x2a,0x2a,0x2a,0x2a,0x2a,0x2a,0x2a,0x2a,0x2a,0x2a,0x2a,0x2a,0x30,0x34,0x35,0x37,0xa,0x4d,0x4f,0x44};

// static char testqr[]={0xd0,0x9e,0xd0,0x9f,0xd0,0x95,0xd0,0xa0,0xd0,0x90,0xd0,0xa6,0xd0,0x98,0xd0,0xaf,0x3a,0xd0,0x9f,0xd0,0xa0,0xd0,0x9e,0xd0,0x94,0xd0,0x90,0xd0,0x96,0xd0,0x90,0xa,0xd0,0x98,0xd0,0xa2,0xd0,0x9e,0xd0,0x93,0xd0,0x9e,0x3a,0x33,0x2e,0x30,0x30,0x20,0x52,0x55,0x42,0xa,0xd0,0xa0,0xd0,0x95,0xd0,0x97,0xd0,0xa3,0xd0,0x9b,0xd0,0xac,0xd0,0xa2,0xd0,0x90,0xd0,0xa2,0x3a,0xd0,0x9e,0xd0,0x94,0xd0,0x9e,0xd0,0x91,0xd0,0xa0,0xd0,0x95,0xd0,0x9d,0xd0,0x9e,0xa,0xd0,0x9a,0xd0,0x90,0xd0,0xa0,0xd0,0xa2,0xd0,0x90,0x3a,0x4d,0x49,0x52,0xa,0x50,0x41,0x4e,0x3a,0x2a,0x2a,0x2a,0x2a,0x2a,0x2a,0x2a,0x2a,0x2a,0x2a,0x2a,0x2a,0x30,0x34,0x35,0x37,0xa,0x4d,0x4f,0x44,0x45,0x3a,0x43,0x4f,0x4e,0x54,0x41,0x43,0x54,0x4c,0x45,0x53,0x53,0x20,0x45,0x4d,0x56,0xa,0xd0,0xa7,0xd0,0x95,0xd0,0x9a,0x3a,0x35,0x33,0x39,0x33,0x34,0x30,0xa,0xd0,0x9a,0xd0,0x9e,0xd0,0x94,0x20,0xd0,0x90,0xd0,0x92,0xd0,0xa2,0x3a,0x38,0x37,0x38,0x32,0x4b,0x53,0xa,0xd0,0x94,0xd0,0x90,0xd0,0xa2,0xd0,0x90,0x3a,0x30,0x39,0x2f,0x30,0x32,0x2f,0x32,0x30,0x32,0x34,0x20,0x31,0x36,0x3a,0x33,0x36,0x3a,0x33,0x37,0xa,0xd0,0xa2,0xd0,0x95,0xd0,0xa0,0xd0,0x9c,0xd0,0x98,0xd0,0x9d,0xd0,0x90,0xd0,0x9b,0x3a,0x57,0x30,0x31,0x31,0x37,0x35,0x31,0x38,0xa,0x4d,0x45,0x52,0x43,0x48,0x41,0x4e,0x54,0x3a,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x39,0x39,0x39,0x30,0x30,0x30,0x30,0x31,0xa,0x43,0x56,0x4d,0x3a,0x4e,0x6f,0x43,0x56,0x4d,0xa,0x54,0x56,0x52,0x3a,0x38,0x30,0x38,0x30,0x30,0x30,0x38,0x30,0x30,0x30,0xa,0x41,0x49,0x44,0x3a,0x41,0x30,0x30,0x30,0x30,0x30,0x30,0x36,0x35,0x38,0x31,0x30,0x31,0x30,0xa,0x41,0x50,0x50,0x3a,0x4d,0x49,0x52,0xa,0x54,0x43,0x3a,0x41,0x41,0x36,0x44,0x37,0x32,0x32,0x42,0x30,0x35,0x32,0x34,0x32,0x38,0x31,0x30,0xa,0x52,0x52,0x4e,0x3a,0x30,0x30,0x32,0x31,0x31,0x36,0x36,0x35,0x37,0x33,0x34,0x30,0xa,0x41,0x4d,0x32,0x3a,0x30,0x2e,0x30,0x30,0xa,0x42,0x41,0x54,0x43,0x48,0x3a,0x32,0x35,0xa,0x45,0x52,0x4e,0x3a,0x39,0x33,0x39,0xa,0xd0,0x9a,0xd0,0x9e,0xd0,0x94,0x20,0xd0,0x9e,0xd0,0xa2,0xd0,0x92,0xd0,0x95,0xd0,0xa2,0xd0,0x90,0x3a,0x30,0x30,0x30,0xa,0xb7,0xb8};
//,0xb7,0xb8,0x
// static char  testqr[]= {0x01, 0x8f, 0xd0, 0x9e, 0xd0, 0x9f, 0xd0, 0x95,0xd0,0x9,0x95};
